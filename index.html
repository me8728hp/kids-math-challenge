<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>キッズ算数アドベンチャー</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00BCD4">

    <!-- iOS PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦁</text></svg>">
</head>

<body>

    <!-- アプリ全体のコンテナ -->
    <div id="app-container">

        <!-- === 0. 向き警告画面 (スマホ縦持ち防止) === -->
        <div id="orientation-warning">
            <div class="message-box">
                <h1>よこむきにしてね！</h1>
                <div class="rotate-icon">📱 ➡️ 📟</div>
            </div>
        </div>

        <!-- === 1. ユーザー登録画面 === -->
        <section id="registration-view" class="view hidden">
            <div class="content-wrapper centered">
                <h1 class="main-title">キッズさんすうアドベンチャー</h1>
                <h2 class="sub-title">おなまえをおしえてね</h2>

                <!-- Returning User Area -->
                <div id="returning-user-area" class="hidden">
                    <div id="user-list-container">
                        <!-- Users will be rendered here -->
                    </div>
                    <button id="add-new-user-btn" class="main-action-btn" style="margin-top: 20px;">
                        ➕ あたらしい おともだち
                    </button>
                </div>

                <!-- Registration Area -->
                <div id="registration-area">
                    <button id="reg-back-btn" class="secondary-btn hidden" style="margin-bottom: 10px;">↩️ もどる</button>
                    <div class="input-group">
                        <label>おなまえ (ひらがな)</label>
                        <input type="text" id="user-name-input" placeholder="例: たろう" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <label>なんさい？</label>
                        <div class="age-selector">
                            <button class="age-btn" data-age="3">3さい</button>
                            <button class="age-btn" data-age="4">4さい</button>
                            <button class="age-btn" data-age="5">5さい</button>
                            <button class="age-btn" data-age="6">6さい</button>
                        </div>
                    </div>
                    <button id="start-btn" class="main-action-btn disabled">はじめる！</button>
                </div>

                <div style="margin-top: 40px; text-align: center;">
                    <button id="update-app-btn" class="secondary-btn"
                        style="font-size: 0.8rem; padding: 5px 15px; opacity: 0.7;">
                        🔄 アプリのこうしん
                    </button>
                </div>
            </div>
        </section>

        <!-- === 2. マップ画面 (レベル選択) === -->
        <section id="map-view" class="view hidden">
            <header class="map-header">
                <div class="user-info">
                    <span id="display-user-name">ゲスト</span> くん/ちゃん
                </div>
                <button id="title-back-btn" class="secondary-btn"
                    style="font-size: 1rem; padding: 0.5rem 1rem;">タイトルへもどる</button>
            </header>
            <div class="map-container-scroll">
                <div class="map-path">
                    <!-- レベルボタンはJSで動的に生成されます -->
                    <!-- 例: <button class="level-node unlocked" data-level="1">1</button> -->
                    <svg class="path-line" width="100%" height="100%"></svg>
                </div>
            </div>
        </section>

        <!-- === 3. ゲームプレイ画面 === -->
        <section id="game-view" class="view hidden">
            <header class="game-header">
                <button id="back-to-map-btn" class="icon-btn">↩️ もどる</button>
                <div class="progress-bar-container">
                    <div id="game-progress-bar" class="progress-fill" style="width: 0%;"></div>
                </div>
                <div id="game-progress-text"
                    style="font-size: 1.2rem; font-weight: bold; color: var(--text-color); margin-left: 10px;">1/10
                </div>
            </header>

            <main class="game-area">
                <div id="question-area" class="question-container">
                    <div id="question-text">もんだい</div>
                    <div id="question-visuals">
                        <!-- 画像やドットなど -->
                    </div>
                </div>

                <div id="options-area" class="options-container">
                    <!-- 選択肢ボタンがここに表示されます -->
                </div>

                <button id="hint-btn" class="hint-btn hidden">💡 ヒント</button>
            </main>

            <!-- フィードバックオーバーレイ (正解/不正解) -->
            <div id="feedback-overlay" class="overlay hidden">
                <div class="feedback-content">
                    <div id="feedback-icon">🌟</div>
                    <div id="feedback-text">すごい！</div>
                </div>
            </div>
        </section>

        <!-- === 4. リザルト画面 === -->
        <section id="result-view" class="view hidden">
            <div class="content-wrapper centered">
                <h1>おつかれさま！</h1>

                <div class="score-display">
                    <div class="stars-container" id="result-stars">
                        <!-- 星がアニメーションで入る -->
                    </div>
                    <p id="result-message">よくがんばったね！</p>
                </div>

                <div class="action-buttons">
                    <button id="retry-btn" class="secondary-btn">もういちど</button>
                    <button id="next-level-btn" class="main-action-btn">つぎへすすむ</button>
                    <button id="return-map-btn" class="secondary-btn">マップにもどる</button>
                </div>
            </div>
        </section>

    </div>

    <!-- 音声ファイル (プレースホルダー読み込み) -->
    <audio id="bgm-main" loop src="assets/bgm_placeholder.mp3"></audio>

    <script src="script.js"></script>
    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered!', reg))
                    .catch(err => console.log('SW failed', err));
            });
        }
    </script>


</body>

</html>